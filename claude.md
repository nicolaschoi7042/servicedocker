# DevOps í™˜ê²½ Docker Compose í”„ë¡œì íŠ¸ ë¶„ì„

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” Jenkins CI/CD, OpenGrok ì½”ë“œ ê²€ìƒ‰, Jenkins Dashboard, ê·¸ë¦¬ê³  Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¥¼ í†µí•©í•œ ì™„ì „í•œ DevOps í™˜ê²½ì„ Docker Composeë¡œ êµ¬ì„±í•©ë‹ˆë‹¤. LDAP ì¸ì¦ì„ í†µí•œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ì‚¬ìš©ì ê´€ë¦¬ì™€ SSL ì¸ì¦ì„œë¥¼ ì ìš©í•œ ë³´ì•ˆ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë¶„ì„

### ì„œë¹„ìŠ¤ êµ¬ì„±ë„
```
[Internet] â†’ [Nginx (SSL/443,80,8080)] â†’ [Jenkins (5000), OpenGrok (8081), Dashboard (3000)]
                         â†“
[LDAP Auth Service] â† â†’ [OpenLDAP]
```

### í•µì‹¬ ì„œë¹„ìŠ¤

#### 1. **Jenkins** (`jenkins`)
- **ì´ë¯¸ì§€**: `docker-jenkins`
- **í¬íŠ¸**: `5000:8080` (ì›¹ UI), `50000:50000` (ì—ì´ì „íŠ¸ ì—°ê²°)
- **ì—­í• **: CI/CD íŒŒì´í”„ë¼ì¸ ê´€ë¦¬
- **ë°ì´í„° ë³¼ë¥¨**: `/data/jenkins` â†’ `/var/jenkins_home`
- **íŠ¹ì§•**:
  - í•œêµ­ ì‹œê°„ëŒ€ ì„¤ì • (`Asia/Seoul`)
  - ë‹¤ì–‘í•œ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ (Git, Gradle, Pipeline, LDAP ë“±)
  - ìë™ ì¬ì‹œì‘ (`unless-stopped`)

#### 2. **OpenGrok** (`opengrok`)
- **ì´ë¯¸ì§€**: `opengrok/docker:latest`
- **í¬íŠ¸**: `8081:8080`
- **ì—­í• **: ì†ŒìŠ¤ì½”ë“œ ê²€ìƒ‰ ë° ë¸Œë¼ìš°ì§•
- **ë°ì´í„° ë³¼ë¥¨**: 
  - `/data/opengrok/src` (ì†ŒìŠ¤ì½”ë“œ)
  - `/data/opengrok/data` (ì¸ë±ìŠ¤)
  - `/data/opengrok/etc` (ì„¤ì •)
  - `/data/opengrok/bin` (ì‹¤í–‰íŒŒì¼)
- **íŠ¹ì§•**: 
  - moros, morow í”„ë¡œì íŠ¸ ì½”ë“œ ì¸ë±ì‹±
  - SSH í‚¤ ì ‘ê·¼ (`/.ssh`)

#### 3. **Jenkins Dashboard** (`jenkins-dashboard`)
- **ì´ë¯¸ì§€**: `jenkins-dashboard-jenkins-dashboard`
- **í¬íŠ¸**: `3000:3000`
- **ì—­í• **: Jenkins ì‘ì—… ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- **íŠ¹ì§•**:
  - LDAP ì¸ì¦ í†µí•©
  - Jenkins API ì—°ë™
  - Next.js ê¸°ë°˜ React ì• í”Œë¦¬ì¼€ì´ì…˜

#### 4. **Nginx** (`nginx`)
- **ì´ë¯¸ì§€**: `opengrok-nginx`
- **í¬íŠ¸**: `80:80`, `443:443`, `8080:8080`
- **ì—­í• **: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ë° SSL í„°ë¯¸ë„¤ì´ì…˜
- **ì„¤ì • íŒŒì¼**: `/data/nginx/conf.d`
- **SSL ì¸ì¦ì„œ**: `/data/nginx/sslcert`
- **ì¸ì¦**: `/data/nginx/htpasswd`

#### 5. **OpenGrok LDAP Auth** (`opengrok-ldap-auth`)
- **ì´ë¯¸ì§€**: `opengrok-ldap-auth`
- **í¬íŠ¸**: `8000:8000`
- **ì—­í• **: OpenGrok LDAP ì¸ì¦ í”„ë¡ì‹œ
- **ì™¸ë¶€ LDAP ì„œë²„**: `172.30.1.97:389`
- **ë„ë©”ì¸**: `roboetech.com`
- **íŠ¹ì§•**: ì™¸ë¶€ LDAP ì„œë²„ì™€ OpenGrok ê°„ ì¸ì¦ ë¸Œë¦¬ì§€

## ğŸŒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

### ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€
```
docker_devops_bridge (172.18.0.0/16)
â”œâ”€â”€ jenkins (172.18.0.4)
â”œâ”€â”€ dashboard (172.18.0.5)
â””â”€â”€ opengrok-ldap-auth (172.18.0.3)

opengrok_docker_devops_bridge (172.20.0.0/16)
â”œâ”€â”€ opengrok (172.20.0.3)
â”œâ”€â”€ nginx (172.20.0.6)
â”œâ”€â”€ jenkins (172.20.0.4)
â”œâ”€â”€ dashboard (172.20.0.2)
â””â”€â”€ opengrok-ldap-auth (172.20.0.5)

External LDAP Server: 172.30.1.97:389
```

### ë„¤íŠ¸ì›Œí¬ íŠ¹ì§•
- **ì´ì¤‘ ë„¤íŠ¸ì›Œí¬**: ì„œë¹„ìŠ¤ ê°„ ìœ ì—°í•œ í†µì‹ ì„ ìœ„í•œ ë©€í‹°ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
- **ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬**: ê¸°ì¡´ ë„¤íŠ¸ì›Œí¬ ì¬ì‚¬ìš©ìœ¼ë¡œ ë‹¤ìš´íƒ€ì„ ì—†ëŠ” ë°°í¬

## ğŸ’¾ ë°ì´í„° ê´€ë¦¬

### ì¤‘ìš” ë°ì´í„° ë³¼ë¥¨
```
/data/
â”œâ”€â”€ jenkins/          # Jenkins í™ˆ ë””ë ‰í† ë¦¬ (ì¤‘ìš” ë°ì´í„°)
â”‚   â”œâ”€â”€ jobs/         # ì‘ì—… ì„¤ì •
â”‚   â”œâ”€â”€ workspace/    # ë¹Œë“œ ì‘ì—…ê³µê°„
â”‚   â”œâ”€â”€ plugins/      # í”ŒëŸ¬ê·¸ì¸
â”‚   â””â”€â”€ users/        # ì‚¬ìš©ì ì„¤ì •
â”œâ”€â”€ nginx/           # Nginx ì„¤ì • (ì¤‘ìš” ë°ì´í„°)
â”‚   â”œâ”€â”€ conf.d/      # ì„œë²„ ì„¤ì •
â”‚   â”œâ”€â”€ sslcert/     # SSL ì¸ì¦ì„œ
â”‚   â””â”€â”€ htpasswd/    # ì¸ì¦ íŒŒì¼
â””â”€â”€ opengrok/        # OpenGrok ë°ì´í„°
    â”œâ”€â”€ src/         # ì†ŒìŠ¤ì½”ë“œ
    â”œâ”€â”€ data/        # ê²€ìƒ‰ ì¸ë±ìŠ¤
    â””â”€â”€ etc/         # ì„¤ì • íŒŒì¼
```

### ë°±ì—… ì „ëµ
- **Jenkins**: `/data/jenkins` ì „ì²´ ë°±ì—… í•„ìˆ˜
- **Nginx**: SSL ì¸ì¦ì„œ ë° ì„¤ì • íŒŒì¼ ë°±ì—…
- **OpenGrok**: ì¸ë±ìŠ¤ ì¬ìƒì„± ê°€ëŠ¥í•˜ë¯€ë¡œ ì†ŒìŠ¤ì½”ë“œë§Œ ë°±ì—…

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. **SSL/TLS ì•”í˜¸í™”**
- Nginxë¥¼ í†µí•œ HTTPS ê°•ì œ ì ìš©
- Let's Encrypt ë˜ëŠ” ì‚¬ì„¤ ì¸ì¦ì„œ ì‚¬ìš©

### 2. **ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬**
- LDAP ì¤‘ì•™ ì¸ì¦ì„ í†µí•œ í†µí•© ì‚¬ìš©ì ê´€ë¦¬
- Jenkins ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´
- Nginx htpasswd ê¸°ë°˜ ì¶”ê°€ ì¸ì¦

### 3. **ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ**
- ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•œ ì„œë¹„ìŠ¤ ê°„ í†µì‹ 
- ì™¸ë¶€ ë…¸ì¶œ í¬íŠ¸ ìµœì†Œí™”

### 4. **ë³´ì•ˆ ëª¨ë‹ˆí„°ë§**
- Jenkins ë³´ì•ˆ í”ŒëŸ¬ê·¸ì¸ í™œì„±í™”
- ì •ê¸°ì ì¸ í”ŒëŸ¬ê·¸ì¸ ì—…ë°ì´íŠ¸

## ğŸš€ ìš´ì˜ ê°€ì´ë“œ

### ì‹œì‘ ëª…ë ¹ì–´
```bash
# ì„œë¹„ìŠ¤ ì‹œì‘
docker compose up -d

# ë¡œê·¸ í™•ì¸
docker compose logs -f [service_name]

# ìƒíƒœ í™•ì¸
docker compose ps
```

### ì„œë¹„ìŠ¤ URL
- **Jenkins**: `https://jenkins.roboetech.com` (í¬íŠ¸ 5000)
- **OpenGrok**: `https://opengrok.roboetech.com` (í¬íŠ¸ 8081)
- **Dashboard**: `https://dashboard.roboetech.com` (í¬íŠ¸ 3000)

### ì˜ì¡´ì„± ìˆœì„œ
1. ì™¸ë¶€ LDAP ì„œë²„ (`172.30.1.97`) - ì™¸ë¶€ ì¸í”„ë¼
2. `opengrok-ldap-auth` (LDAP ì¸ì¦ í”„ë¡ì‹œ)
3. `jenkins`, `opengrok`, `jenkins-dashboard` (í•µì‹¬ ì„œë¹„ìŠ¤)
4. `nginx` (í”„ë¡ì‹œ - ëª¨ë“  ì„œë¹„ìŠ¤ ì˜ì¡´)

## ğŸ”§ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 1. **ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨**
```bash
# ë„¤íŠ¸ì›Œí¬ í™•ì¸
docker network ls
docker network inspect docker_devops_bridge

# ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸
docker images
```

#### 2. **ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì˜¤ë¥˜**
```bash
# ê¶Œí•œ í™•ì¸
ls -la /data/
sudo chown -R 1000:1000 /data/jenkins  # Jenkins ì‚¬ìš©ì
```

#### 3. **LDAP ì¸ì¦ ì‹¤íŒ¨**
```bash
# LDAP ì¸ì¦ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker compose logs opengrok-ldap-auth

# ì™¸ë¶€ LDAP ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
ldapsearch -x -H ldap://172.30.1.97:389 -b dc=roboetech,dc=com

# ì¸ì¦ ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬
curl http://localhost:8000/health
```

#### 4. **SSL ì¸ì¦ì„œ ë¬¸ì œ**
```bash
# ì¸ì¦ì„œ í™•ì¸
ls -la /data/nginx/sslcert/
openssl x509 -in /data/nginx/sslcert/cert.pem -text -noout
```

### ì„±ëŠ¥ ìµœì í™”

#### 1. **Jenkins ì„±ëŠ¥ íŠœë‹**
- JVM í™ ì‚¬ì´ì¦ˆ ì¡°ì •: `JAVA_OPTS` í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •
- ë¶ˆí•„ìš”í•œ í”ŒëŸ¬ê·¸ì¸ ì œê±°
- ë¹Œë“œ íˆìŠ¤í† ë¦¬ ì •ë¦¬

#### 2. **OpenGrok ì„±ëŠ¥**
- ì¸ë±ì‹± ì£¼ê¸° ì¡°ì •
- ë©”ëª¨ë¦¬ í• ë‹¹ ìµœì í™”

## ğŸ“‹ ìœ ì§€ë³´ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì¼ê°„
- [ ] ì„œë¹„ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§
- [ ] ë¡œê·¸ í™•ì¸ ë° ì˜¤ë¥˜ ê²€í† 

### ì£¼ê°„
- [ ] ë°±ì—… ìƒíƒœ í™•ì¸
- [ ] ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
- [ ] SSL ì¸ì¦ì„œ ë§Œë£Œì¼ í™•ì¸

### ì›”ê°„
- [ ] Jenkins í”ŒëŸ¬ê·¸ì¸ ì—…ë°ì´íŠ¸
- [ ] ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
- [ ] ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©
- [ ] ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê²€í† 

### ì—°ê°„
- [ ] SSL ì¸ì¦ì„œ ê°±ì‹ 
- [ ] ë°±ì—…/ë³µêµ¬ í…ŒìŠ¤íŠ¸
- [ ] ì¬í•´ ë³µêµ¬ ê³„íš ê²€í† 

## ğŸ”„ ì—…ê·¸ë ˆì´ë“œ ì „ëµ

### ì„œë¹„ìŠ¤ë³„ ì—…ê·¸ë ˆì´ë“œ ìˆœì„œ
1. **OpenGrok LDAP Auth**: ì¸ì¦ í”„ë¡ì‹œ - ìµœì†Œ ë‹¤ìš´íƒ€ì„
2. **Jenkins**: ë©”ì´ì € ì—…ê·¸ë ˆì´ë“œ ì‹œ ì£¼ì˜ (í”ŒëŸ¬ê·¸ì¸ í˜¸í™˜ì„±)
3. **OpenGrok**: ì¸ë±ìŠ¤ ì¬ìƒì„± í•„ìš”
4. **Nginx**: ë¬´ì¤‘ë‹¨ ì—…ê·¸ë ˆì´ë“œ ê°€ëŠ¥

### ë°±ì—… ì „ í•„ìˆ˜ ì‘ì—…
```bash
# ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ì§€
docker compose stop

# ë°ì´í„° ë°±ì—…
tar -czf backup-$(date +%Y%m%d).tar.gz /data/

# ì»¨í…Œì´ë„ˆ ë°±ì—…
docker commit jenkins jenkins-backup-$(date +%Y%m%d)
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ì•ŒëŒ

### ê¶Œì¥ ëª¨ë‹ˆí„°ë§ ë„êµ¬
- **Prometheus + Grafana**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì‹œê°í™”
- **ELK Stack**: ë¡œê·¸ ë¶„ì„
- **Uptime Robot**: ì™¸ë¶€ ì„œë¹„ìŠ¤ ê°€ìš©ì„± ëª¨ë‹ˆí„°ë§

### ì•ŒëŒ ì„¤ì • ëŒ€ìƒ
- ì„œë¹„ìŠ¤ ë‹¤ìš´
- ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ 80% ì´ˆê³¼
- SSL ì¸ì¦ì„œ ë§Œë£Œ 30ì¼ ì „
- Jenkins ë¹Œë“œ ì‹¤íŒ¨ìœ¨ ì¦ê°€

---

**ğŸ¤– Generated with [Claude Code](https://claude.ai/code)**

**Co-Authored-By: Claude <noreply@anthropic.com>**